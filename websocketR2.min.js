function WebSocketR2(e,t){function n(){c.onopen=function(){o()},c.onmessage=function(e){i(e)},c.onclose=function(){u()}}function o(){m=!0,f?void 0!=g&&g():(void 0!=R&&R(),f=!0)}function i(e){var t={};try{var n=JSON.parse(e.data);try{t.id=n.id,t.data=n.data,void 0!=t.id?a(t.id)?(d[t.id](t),delete d[t.id]):console.error("ID from server is not a number. "+JSON.stringify(t)):void 0!=q&&q(t)}catch(e){console.error(e)}}catch(t){console.warn("Response from server is not json."),void 0!=q&&q(e.data)}}function u(){m&&(m=!1,void 0!=h&&h(),t.autoReconnect&&r())}function r(){m||c.readyState!=WebSocket.CLOSED||(c=new WebSocket(e),n())}function s(){if(l.length>0)for(var e=0,n=l.length,o=(new Date).getTime(),i=0;i<n&&!(i>=n-e)&&o-l[i].timestamp>t.requestTimeout;i++)void 0==d[l[i].request.id]?(console.debug("Callback already received. Removing id = "+l[i].request.id),l.shift(),i--,e++):(console.debug("params.requestTimeout detected. Resending id = "+l[i].request.id),c.send(JSON.stringify(l[i].request)),l[i].timestamp=o,l.push(l.shift()),i--,e++);setTimeout(function(){s()},t.requestRetryInterval)}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}var c=void 0,d={},l=[],v=0,f=!1,m=!1,R=void 0,q=void 0,h=void 0,g=void 0;void 0!=t&&null!=t||(t={}),void 0!=t.autoReconnect&&null!=t.autoReconnect||(t.autoReconnect=!0),void 0!=t.autoReconnectInterval&&null!=t.autoReconnectInterval||(t.autoReconnectInterval=1e3),void 0!=t.requestTimeout&&null!=t.requestTimeout||(t.requestTimeout=3e4),void 0!=t.requestRetryInterval&&null!=t.requestRetryInterval||(t.requestRetryInterval=5e3),t.requestRetryInterval<t.requestTimeout&&(t.requestRetryInterval=t.requestTimeout),void 0!=t.requestRetryQueueMaxLength&&null!=t.requestRetryQueueMaxLength||(t.requestRetryQueueMaxLength=1e3),this.onopen=function(e){R=e},this.onmessage=function(e){q=e},this.onclose=function(e){h=e},this.onreopen=function(e){g=e},this.send=function(e,n){var o={};o.data=e,void 0!=n&&null!=n&&(o.id=v,d[v]=n,l.push({request:o,timestamp:(new Date).getTime()}),l.length>t.requestRetryQueueMaxLength&&l.shift(),v<Number.MAX_SAFE_INTEGER?v++:v=0),c.send(JSON.stringify(o))},t.autoReconnect&&setInterval(function(){r()},t.autoReconnectInterval),t.requestTimeout>0&&s(),c=new WebSocket(e),n()}